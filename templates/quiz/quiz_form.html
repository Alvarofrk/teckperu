{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Inicio' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programs' %}">{% trans 'Programas' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'program_detail' course.program.id %}">{{ course.program }}</a></li>
        <li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}">{{ course }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'quiz_index' course.slug %}">{% trans 'Cuestionarios' %}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{% trans 'Formulario de Cuestionario' %}</li>
    </ol>
</nav>

<div class="title-1">{% trans 'Formulario de cuestionario para' %} {{ course|truncatechars:15 }}</div>
<br><br>

<div class="container">

    <form action="" method="POST">{% csrf_token %}
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <div hidden>
                            <label for="course">{{ form.course.label }}</label><br> {{ form.course }}
                            <span class="danger">{{ form.course.errors }}</span>
                            <span class="danger">{{ form.course.errors }}</span>
                        </div>                    
                        {{ form.category|as_crispy_field }}                    
                        {{ form.title|as_crispy_field }}
                        {{ form.pass_mark|as_crispy_field }}
                        {{ form.description|as_crispy_field }}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <div hidden>
                            <label for="questions">{{ form.questions.label }}</label><br> {{ form.questions }}
                            <span class="danger">{{ form.questions.errors }}</span>
                            <small class="d-block text-muted">{% trans 'Mantén presionado' %} "Control", {% trans 'o' %} "Command" {% trans 'en un Mac, para seleccionar más de uno.' %}</small>
                        </div>
                        <div class="form-check mb-3">
                            {{ form.random_order }}
                            <label class="form-check-label" for="{{ form.random_order.id_for_label }}">
                                {{ form.random_order.label }}
                            </label>
                            {% if form.random_order.help_text %}
                                <small class="form-text text-muted">{{ form.random_order.help_text }}</small>
                            {% endif %}
                            {% if form.random_order.errors %}
                                <div class="text-danger">{{ form.random_order.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-check mb-3">
                            {{ form.answers_at_end }}
                            <label class="form-check-label" for="{{ form.answers_at_end.id_for_label }}">
                                {{ form.answers_at_end.label }}
                            </label>
                            {% if form.answers_at_end.help_text %}
                                <small class="form-text text-muted">{{ form.answers_at_end.help_text }}</small>
                            {% endif %}
                            {% if form.answers_at_end.errors %}
                                <div class="text-danger">{{ form.answers_at_end.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-check mb-3">
                            {{ form.exam_paper }}
                            <label class="form-check-label" for="{{ form.exam_paper.id_for_label }}">
                                {{ form.exam_paper.label }}
                            </label>
                            {% if form.exam_paper.help_text %}
                                <small class="form-text text-muted">{{ form.exam_paper.help_text }}</small>
                            {% endif %}
                            {% if form.exam_paper.errors %}
                                <div class="text-danger">{{ form.exam_paper.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-check mb-3">
                            {{ form.single_attempt }}
                            <label class="form-check-label" for="{{ form.single_attempt.id_for_label }}">
                                {{ form.single_attempt.label }}
                            </label>
                            {% if form.single_attempt.help_text %}
                                <small class="form-text text-muted">{{ form.single_attempt.help_text }}</small>
                            {% endif %}
                            {% if form.single_attempt.errors %}
                                <div class="text-danger">{{ form.single_attempt.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="form-check mb-3">
                            {{ form.draft }}
                            <label class="form-check-label" for="{{ form.draft.id_for_label }}">
                                {{ form.draft.label }}
                            </label>
                            {% if form.draft.help_text %}
                                <small class="form-text text-muted">{{ form.draft.help_text }}</small>
                            {% endif %}
                            {% if form.draft.errors %}
                                <div class="text-danger">{{ form.draft.errors }}</div>
                            {% endif %}
                        </div>             
                    </div>
                </div>
            </div>
        </div>
        <button class="btn btn-primary my-4" id="{% if form.is_valid %}btn-transition{% endif %}" type="submit">{% trans 'Guardar' %} &amp; {% trans 'Continuar' %}</button>
    </form>
</div>

{% endblock %}

{% block extra_css %}
<style>
    /* Asegurar que los checkboxes sean visibles y funcionen correctamente */
    .form-check-input {
        width: 1.25rem !important;
        height: 1.25rem !important;
        margin-top: 0.125rem !important;
        margin-right: 0.5rem !important;
        display: inline-block !important;
        opacity: 1 !important;
        cursor: pointer !important;
        position: relative !important;
        pointer-events: auto !important;
        -webkit-appearance: checkbox !important;
        -moz-appearance: checkbox !important;
        appearance: checkbox !important;
    }
    
    .form-check-input:checked {
        background-color: #0d6efd !important;
        border-color: #0d6efd !important;
    }
    
    .form-check-label {
        cursor: pointer !important;
        margin-left: 0.5rem !important;
        user-select: none;
    }
    
    .form-check {
        padding-left: 0 !important;
        margin-bottom: 0.5rem !important;
        display: flex !important;
        align-items: flex-start !important;
    }
    
    /* Hacer que el label también sea clickeable */
    .form-check-label:hover {
        color: #0d6efd;
    }
    
    /* Asegurar que no haya elementos que bloqueen los clicks */
    .form-check input[type="checkbox"] {
        z-index: 1 !important;
        pointer-events: auto !important;
    }
</style>
{% endblock %}

{% block js %}
<script>
    const transitionButton = document.getElementById('btn-transition');
    if (transitionButton) {
        transitionButton.addEventListener('click', () => {
            const cardTransition = document.getElementById('card-transition');
            if (cardTransition) {
                cardTransition.style.animation = 'card-transition 5s ease-in-out forwards';
            }
        });
    }
    
    // Asegurar que los checkboxes funcionen correctamente
    document.addEventListener('DOMContentLoaded', function() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(function(checkbox) {
            // Asegurar que el checkbox sea visible y clickeable
            checkbox.style.display = 'inline-block';
            checkbox.style.visibility = 'visible';
            checkbox.style.opacity = '1';
            checkbox.style.position = 'relative';
            checkbox.style.pointerEvents = 'auto';
            checkbox.disabled = false;
            
            // Hacer que el label también active el checkbox al hacer click
            const label = document.querySelector('label[for="' + checkbox.id + '"]');
            if (label) {
                label.style.cursor = 'pointer';
                label.addEventListener('click', function(e) {
                    if (e.target !== checkbox) {
                        checkbox.click();
                    }
                });
            }
        });
    });
</script>
{% endblock js %}